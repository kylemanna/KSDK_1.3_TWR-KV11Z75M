<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.6"/>
<title>Kinetis SDK v.1.3 Demo Applications User&#39;s Guide: Thermistor Lab Demo</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
  $(window).load(resizeHeight);
</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="fs_logo.gif"/></td>
  <td style="padding-left: 0.5em;">
   <div id="projectname">Kinetis SDK v.1.3 Demo Applications User&#39;s Guide
   &#160;<span id="projectnumber">Rev. 0</span>
   </div>
   <div id="projectbrief">Freescale Semiconductor, Inc.</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.6 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="modules.html"><span>API&#160;Reference</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('group__thermistor__lab.html','');});
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Groups</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Pages</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">Thermistor Lab Demo</div>  </div>
</div><!--header-->
<div class="contents">
<p>This demo application demonstrates how to use PDB to trigger ADC and measure on-board thermistor.</p>
<h1><a class="anchor" id="Ovw"></a>
Overview</h1>
<p>This lab shows how to configure and use the ADC module to sample the differential voltage across on-board thermistors RT1-RT4. If the user touches any on-board thermistor with a finger, the lab application detects a change in the thermistor temperature and starts flashing the corresponding LED pair.</p>
<ul>
<li>The lab tutorial demonstrates:<ul>
<li>how to configure ADC module to read differential inputs</li>
<li>how to filter and process ADC results</li>
<li>how to use FreeMASTER visualization tool to display sampled results.</li>
</ul>
</li>
</ul>
<h1><a class="anchor" id="SH"></a>
Supported Hardware</h1>
<p>This Tower System modules are supported by the Thermistor Lab demo.</p>
<p>-TWR-KV10Z32 -TWR-KV11Z75M</p>
<h1><a class="anchor" id="SR"></a>
System Requirement</h1>
<h2><a class="anchor" id="HwR"></a>
Hardware requirements</h2>
<ul>
<li>J-Link ARM</li>
<li>P&amp;E Micro Multi-link universal</li>
<li>Mini/micro USB cable</li>
<li>USB A to micro AB cable</li>
<li>Hardware (tower/base board, ...) for specific device</li>
<li>Personal Computer</li>
</ul>
<h2><a class="anchor" id="SDKReq"></a>
Software requirements</h2>
<ul>
<li>The project files are in: &lt;SDK_Install&gt;/examples/&lt;board&gt;/demo_apps/thermistor_lab/&lt;toolchain&gt;.</li>
<li>Library dependencies: ksdk_platform_lib</li>
</ul>
<h1><a class="anchor" id="GS"></a>
Getting Started</h1>
<h2><a class="anchor" id="PtD"></a>
Prepare the Demo</h2>
<ol type="1">
<li>Ensure that these jumpers are shorted.</li>
</ol>
<h2>TWR-KV10Z32:</h2>
<div> <table class="doxtable">
<tr>
<td align="center">J8 </td><td align="center">2-3 </td><td align="center"></td></tr>
<tr>
<td align="center">J11 </td><td align="center">1-2 </td><td align="center">3-4  </td></tr>
<tr>
<td align="center">J12 </td><td align="center">1-2 </td><td align="center">3-4  </td></tr>
<tr>
<td align="center">J13 </td><td align="center">1-2 </td><td align="center">3-4  </td></tr>
<tr>
<td align="center">J14 </td><td align="center">1-2 </td><td align="center">3-4  </td></tr>
</table>
</div><h2>TWR-KV11Z75M:</h2>
<div> <table class="doxtable">
<tr>
<td align="center">J6 </td><td align="center">1-2 </td><td align="center">3-4  </td></tr>
<tr>
<td align="center">J7 </td><td align="center">1-2 </td><td align="center">3-4  </td></tr>
<tr>
<td align="center">J8 </td><td align="center">1-2 </td><td align="center">3-4  </td></tr>
<tr>
<td align="center">J9 </td><td align="center">1-2 </td><td align="center">3-4  </td></tr>
<tr>
<td align="center">J13 </td><td align="center">2-3 </td><td align="center"></td></tr>
</table>
</div><ol type="1">
<li>Download the program to the target board.</li>
<li>Touch 4 on-board thermistor to see LED change.</li>
</ol>
<p>For detailed instructions, see a Kinetis SDK User's Guide for your board.</p>
<h2><a class="anchor" id="DCO"></a>
Demo Code Overview</h2>
<p>The lab application configures both ADCs to be triggered by the FlexTimer0 via the PDB. The FlexTimer is configured to generate the 16 KHZ PWM and the channel1 trigger is used to trigger both ADCs via the PDB. The PDB is configured to generate four delayed trigger signals to both ADCs per FlexTimer0 Channel 1 trigger and, as a result, 4 ADCs samples are converted per each Flextimer channel trigger. The ADC is configured to be in a 16-bit differential and ping-pong mode.</p>
<p>When an ADC conversion is complete, an interrupt is generated by the ADC module and an interrupt service routine is executed. The interrupt service routine ADCn_ISR() calls the ADCn_Task which executes these tasks:</p>
<p>reads ADC results registers. filters ADC results with low-pass FIR filter. differentiates filtered results to detect a change in a voltage across the thermistor. detects a negative/positive slope of a voltage change to determine which LED is turned on/off. executes a software timer, whose time out period is 100 ms and resets every 400 ms. The software timer is used to generate a time base for LEDs flashing.</p>
<h3><a class="anchor" id="MoO"></a>
ADC Differential Mode of Operation</h3>
<p>To measure a voltage across the thermistor, configure the ADC for a differential mode of operation. In a differential mode, the ADC measures a difference between two analogous inputs. The ADC enables selecting input pairs which are treated as differential inputs.</p>
<h3>Detection of a Change of Thermistor Voltage</h3>
<p>If a user places a finger on a thermistor, its temperature increases. The temperature rise results in a voltage decrease across the resistor. If the user removes the finger, the temperature decreases and the voltage goes up.</p>
<p>A simple differentiators are used to detect a voltage change. The filtered thermistor voltage is stored in a buffer. The buffer size is defined by the BUFF_SIZE. The differentiator calculates a difference between an actual voltage sample and a sample delayed by i_delay pointer, which points to the buffer.</p>
<div class="fragment"><div class="line">delta_rt1 = rt1_filt -rt1_filt_buff[i_delay];</div>
</div><!-- fragment --><p>If the voltage across the thermistor decreases, the differentiator returns a negative value. If the voltage increases, the differentiator returns a positive value. If there is no change in voltage, the deviator output returns zero. The bigger the slope of voltage increase/decrease, the more positive/negative value the differentiator returns. The lab application uses this information to detect if the finger is placed on the particular thermistor or if the finger was removed. Placing/removing a finger on the thermistor is characterized by a certain slope (rate) of voltage decrease/increase. The application defines positive and negative thresholds for each thermistor. If a difference output exceeds threshold limits (for at least three consequent samples), an action is taken and a corresponding LED starts to flash. </p>
</div><!-- contents -->
</div><!-- doc-content -->
<!-- HTML footer for doxygen 1.8.5-->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul class="foot">
    <li class="footer">Wed Nov 11 2015 &copy; 2015 Freescale Semiconductor, Inc. All rights reserved.
    </li>
  </ul>
</div>
</body>
</html>
