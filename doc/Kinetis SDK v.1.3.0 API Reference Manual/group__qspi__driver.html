<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.6"/>
<title>Kinetis SDK v.1.3 API Reference Manual: QSPI Peripheral Driver</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
  $(window).load(resizeHeight);
</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="customdoxygen.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="fs_logo.gif"/></td>
  <td style="padding-left: 0.5em;">
   <div id="projectname">Kinetis SDK v.1.3 API Reference Manual
   &#160;<span id="projectnumber">Rev. 0</span>
   </div>
   <div id="projectbrief">Freescale Semiconductor, Inc.</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.6 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="modules.html"><span>API&#160;Reference</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('group__qspi__driver.html','');});
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Data Structures</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Typedefs</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>Enumerations</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&#160;</span>Enumerator</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(7)"><span class="SelectionMark">&#160;</span>Groups</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(8)"><span class="SelectionMark">&#160;</span>Pages</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">QSPI Peripheral Driver<div class="ingroups"><a class="el" href="group__qspi.html">Quad Serial Peripheral Interface (QSPI)</a></div></div>  </div>
</div><!--header-->
<div class="contents">
<p>This section describes the programming interface of the QSPI peripheral driver.</p>
<p>The following is a basic step-by-step overview of how to initialize QSPI and use QSPI for transfers. For API specific examples, see the examples below. The following example uses the interrupt-driven APIs and a blocking transfer to illustrate a high-level step-by-step usage.</p>
<div class="fragment"><div class="line"><span class="comment">//Init QSPI module. User should transfer a state memory for QSPI internal use</span></div>
<div class="line">QSPI_DRV_Init(instance, &amp;state);</div>
<div class="line"><span class="comment">//Get QSPI default settings and configure the QSPI</span></div>
<div class="line">qspi_config_t config;</div>
<div class="line"><span class="comment">//Get default QSPI configure parameters.</span></div>
<div class="line">QSPI_DRV_GetDefaultQspiConfig(&amp;config);</div>
<div class="line"><span class="comment">//Configure QSPI buffer size according to flash page size connected with QSPI </span></div>
<div class="line">config.AHBbufferSize[3] = FLASH_PAGE_SIZE;</div>
<div class="line"><span class="comment">//Write QSPI configure param into QSPI registers.</span></div>
<div class="line">QSPI_DRV_ConfigQspi(instance, &amp;config);</div>
<div class="line"><span class="comment">//According to serial flash feature to configure flash settings</span></div>
<div class="line">qspi_flash_config_t flash_config;</div>
<div class="line">...</div>
<div class="line">QSPI_DRV_ConfigFlash(instance, &amp;flash_config);</div>
<div class="line"><span class="comment">//Execute serial flash command in cmdIdx of LUT.</span></div>
<div class="line">QSPI_DRV_ExecuteFlashCommand(instance, cmdIdx);</div>
<div class="line"><span class="comment">//If it is program command, provide data using blocking way.</span></div>
<div class="line">QSPI_DRV_WriteDataBlocking(instance,src_addr,size);</div>
<div class="line">...</div>
<div class="line">...</div>
<div class="line"><span class="comment">//Deinitialize QSPI module.</span></div>
<div class="line">QSPI_DRV_Deinit(instance);</div>
</div><!-- fragment --><h1><a class="anchor" id="QSPIRtSS"></a>
QSPI Run-time state structures</h1>
<p>The QSPI driver uses a run-time state structure to track the ongoing data transfers. The state structure for the driver is called qspi_state_t. This structure holds data that the QSPI peripheral driver uses to communicate between the transfer function and the interrupt handler and other driver functions. The interrupt handler in the driver also uses this information to keep track of its progress. The user is only required to pass the memory for the run-time state structure. The QSPI driver populates the members.</p>
<h1><a class="anchor" id="QSPIcS"></a>
QSPI Configure structures</h1>
<p>The QSPI driver uses instances of the qspi_config_t structure to represent the QSPI bus and buffer configuration required to communicate to an external flash that is connected to QSPI.</p>
<p>The configuration structure consists of the following settings: SCLK (baud rate in Hz), clock source, watermark settings, and AHB buffer settings for read data via AHB bus.</p>
<h1><a class="anchor" id="QSPIfcS"></a>
QSPI Flash Configure structures</h1>
<p>The QSPI driver uses instances of the qspi_flash_config_t structure to represent the flash features connected to the QSPI module.</p>
<p>The configuration structure consists of the following settings: flash size (supports maximum 2 flash), lookup table for flash commands, flash timing settings, flash endianess, and specific flash feature settings.</p>
<h1><a class="anchor" id="QSPIInit"></a>
QSPI Initialization</h1>
<p>To initialize the QSPI driver, call the QSPI_DRV_Init() function and pass the instance number of the QSPI peripheral. For example, to use the QSPI0 module, pass a value 0 to the initialization function. In addition, the user also passes in the pointer to the run-time state structure used by the driver to keep track of data transfers.</p>
<h1><a class="anchor" id="QSPITrnsfrs"></a>
QSPI Transfers</h1>
<p>The driver supports three different methods to transfer data: polling, interrupt, and DMA. The polling transfer is a blocking function and others are both non-blocking.</p>
<p>When using DMA to transfer data, ensure that the data is consistent when there is cache for memory. This means, when reading/ writing the data from/to memory, the application should ensure that data from or to the memory device is not cached.</p>
<p>Example for non-blocking function APIs and associated functions (interrupt and DMA-driven): </p>
<div class="fragment"><div class="line"><span class="comment">//Write data via eDMA, it is non-blocking</span></div>
<div class="line">QSPI_DRV_WriteDataEdma(instance, src_addr,size);</div>
<div class="line">....</div>
<div class="line"><span class="comment">//Wait until all data is written into TXFIFO</span></div>
<div class="line"><span class="keywordflow">while</span>(QSPI_DRV_GetTxStatus(instance) == kStatus_QSPI_DeviceBusy)</div>
<div class="line">{}</div>
</div><!-- fragment --><h1><a class="anchor" id="QSPIDeinit"></a>
QSPI De-initialization</h1>
<p>To deinitialize and shut down the QSPI module, call the function QSPI_DRV_Deinit(). </p>
</div><!-- contents -->
</div><!-- doc-content -->
<!-- HTML footer for doxygen 1.8.5-->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul class="foot">
    <li class="footer">Thu Sep 24 2015 &copy; 2015 Freescale Semiconductor, Inc. All rights reserved.
    </li>
  </ul>
</div>
</body>
</html>
