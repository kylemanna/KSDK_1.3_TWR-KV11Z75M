<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.6"/>
<title>Kinetis SDK v.1.3 API Reference Manual: FlexIO I2C Master peripheral driver</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
  $(window).load(resizeHeight);
</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="customdoxygen.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="fs_logo.gif"/></td>
  <td style="padding-left: 0.5em;">
   <div id="projectname">Kinetis SDK v.1.3 API Reference Manual
   &#160;<span id="projectnumber">Rev. 0</span>
   </div>
   <div id="projectbrief">Freescale Semiconductor, Inc.</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.6 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="modules.html"><span>API&#160;Reference</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('group__flexio__i2c__master__driver.html','');});
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Data Structures</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Typedefs</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>Enumerations</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&#160;</span>Enumerator</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(7)"><span class="SelectionMark">&#160;</span>Groups</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(8)"><span class="SelectionMark">&#160;</span>Pages</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">FlexIO I2C Master peripheral driver<div class="ingroups"><a class="el" href="group__flexio__i2c.html">FlexIO-simulated I2C (FlexIO_I2C)</a></div></div>  </div>
</div><!--header-->
<div class="contents">
<p>This section describes the programming interface of the FlexIO I2C master mode peripheral driver. The FlexIO I2C master peripheral driver provides functions for a master device to send and receive data.</p>
<h1><a class="anchor" id="FlexIOI2CDevS"></a>
FlexIO I2C Device structures</h1>
<p>The driver uses an instantiation of the flexio_i2c_state_t structure to maintain the current state of a particular FlexIO-simulated I2C master driver. This structures holds data that is used by the FlexIO-simulated I2C master peripheral driver to communicate between the transmit and receive transfer functions and the interrupt handler. The interrupt handler also uses this information to keep track of its progress. Because the driver itself does not statically allocate memory, the caller provides memory for the driver state structure during initialization by providing a structure.</p>
<h1><a class="anchor" id="FlexIOI2CUsCS"></a>
FlexIO I2C user configuration structures</h1>
<p>The FlexIO-simulated I2C driver uses instances of the user configuration structure flexio_i2c_userconfig_t for the FlexIO-simulated I2C driver. The user settings include: I2C mode(master or slave), baud rate, and the associated FlexIO timers, shifters, and pins for SDA and SCL.</p>
<h1><a class="anchor" id="FlexIOI2CMasterInit"></a>
FlexIO I2C Master Initialization</h1>
<ol>
<li>
To initialize the FlexIO I2C Master driver, call the FLEXIO_I2C_DRV_MasterInit() function and pass the instance number of the FlexIO peripheral, memory for the run-time state structure, and a pointer to the user configuration structure. For example, to use FlexIO0 pass a value of 0 to the initialization function. </li>
<li>
Then, pass the memory for the run-time state structure. </li>
<li>
Finally, pass a user configuration structure of the type flexio_i2c_userconfig_t as shown here: </li>
</ol>
<div class="fragment"><div class="line"><span class="comment">// FlexIO I2C Master configuration structure</span></div>
<div class="line"><span class="keyword">typedef</span> <span class="keyword">struct </span>flexio_i2c_userconfig{</div>
<div class="line">    uint32_t baudRate;    </div>
<div class="line">    flexio_i2c_hwconfig_t i2cHwConfig;   </div>
<div class="line">}flexio_i2c_userconfig_t;</div>
</div><!-- fragment --><p> The flexio_i2c_userconfig instantiation can be easily modified to configure the FlexIO I2C master peripheral driver either to a different baud rate or using different FlexIO hardware resource. This is an example code to set up a user FlexIO I2C master configuration instantiation:</p>
<div class="fragment"><div class="line">flexio_i2c_userconif_t i2cMasterConfig;</div>
<div class="line">i2cMasterConfig.baudRate = 100000;</div>
<div class="line">i2cMasterConfig.i2cHwConfig.sdaPinIdx = 0;</div>
<div class="line">i2cMasterConfig.i2cHwConfig.sclkPinIdx = 1;</div>
<div class="line">i2cMasterConfig.i2cHwConfig.shifterIdx[0] = 0;</div>
<div class="line">i2cMasterConfig.i2cHwConfig.shifterIdx[1] = 1;</div>
<div class="line">i2cMasterConfig.i2cHwConfig.timerIdx[0] = 0;</div>
<div class="line">i2cMasterConfig.i2cHwConfig.timerIdx[1] = 1;  </div>
</div><!-- fragment --><p> This example shows how to call the FLEXIO_I2C_DRV_MasterInit() given the user configuration structure and the FlexIO instance 0. </p>
<div class="fragment"><div class="line">uint32_t flexioInstance = 0;</div>
<div class="line">flexio_i2c_state_t i2cState; <span class="comment">// user provides memory for the driver state structure</span></div>
<div class="line"></div>
<div class="line">FLEXIO_I2C_DRV_MasterInit(flexioInstance, &amp;i2cState, &amp;i2cMasterConfig);</div>
</div><!-- fragment --><h1><a class="anchor" id="FlexIOI2CMasterDtrans"></a>
FlexIO I2C Master Data Transactions</h1>
<p>The driver implements transmit and receive functions to transfer buffers of data in blocking and non-blocking modes.</p>
<p>The non-blocking transmit and receive functions include the FLEXIO_I2C_DRV_MasterSendData() and FLEXIO_I2C_DRV_MasterReceiveData() functions.</p>
<p>The blocking (async) transmit and receive functions include the FLEXIO_I2C_DRV_MasterSendDataBlocking() and FLEXIO_I2C_DRV_MasterReceiveDataBlocking() functions.</p>
<p>In all cases mentioned here, the functions are interrupt-driven.</p>
<p>This code example show how to use the functions, assuming that the FlexIO-simulated I2C Master module has been initialized as described previously in the Initialization Section.</p>
<p>This is an example code for blocking transfer functions transmit and receive:</p>
<div class="fragment"><div class="line">uint8_t sourceBuff[26] ={0}; <span class="comment">// sourceBuff can be filled out with desired data</span></div>
<div class="line">uint8_t readBuffer[10] = {0}; <span class="comment">// readBuffer gets filled </span></div>
<div class="line"></div>
<div class="line">uint32_t byteCount = <span class="keyword">sizeof</span>(sourceBuff);</div>
<div class="line">uint32_t rxRemainingSize = <span class="keyword">sizeof</span>(readBuffer);</div>
<div class="line"></div>
<div class="line"><span class="comment">// For each use there, set timeout as &quot;1&quot;</span></div>
<div class="line"><span class="comment">// i2cState is the run-time state. Pass in memory for this </span></div>
<div class="line"><span class="comment">// declared previously in the initialization section</span></div>
<div class="line">FLEXIO_I2C_DRV_MasterSendDataBlocking(i2cState, sourceBuff, byteCount, 1); <span class="comment">// Function won&#39;t return until transmit is complete</span></div>
<div class="line">FLEXIO_I2C_DRV_MasterReceiveDataBlocking(i2cState, readBuffer, 1, timeoutValue); <span class="comment">// Function won&#39;t return until it receives all data</span></div>
</div><!-- fragment --><p>This is an example code for non-blocking (async) transfer functions transmit and receive:</p>
<div class="fragment"><div class="line"> uint8_t *pTxBuff;</div>
<div class="line"> uint8_t rxBuff[10];</div>
<div class="line"> uint32_t txBytesRemaining, rxBytesRemaining;</div>
<div class="line"></div>
<div class="line"> <span class="comment">// Assume pTxBuff and txSize have been initialized</span></div>
<div class="line"> FLEXIO_I2C_DRV_MasterSendData(i2cState, pTxBuff, txSize);</div>
<div class="line"></div>
<div class="line"> <span class="comment">// Check on status of transmit and wait until done; The code can do something else and </span></div>
<div class="line"> <span class="comment">// check back later</span></div>
<div class="line"> <span class="keywordflow">while</span> (FLEXIO_I2C_DRV_MasterGetTransmitStatus(i2cState, &amp;txBytesRemaining) == kStatus_FlexIO_I2C_XBusy);</div>
<div class="line"></div>
<div class="line"> <span class="comment">// To receive, assume rxBuff is set up to receive data and rxSize is initialized</span></div>
<div class="line">FLEXIO_I2C_DRV_MasterReceiveData(i2cState, rxBuff, rxSize);</div>
<div class="line"></div>
<div class="line"> <span class="comment">// Check on receive status and wait until done;  The code can do something else and </span></div>
<div class="line"> <span class="comment">// check back later</span></div>
<div class="line"> <span class="keywordflow">while</span> (FLEXIO_I2C_DRV_MasterGetReceiveStatus(i2cState, &amp;rxBytesRemaining) == kStatus_FlexIO_I2C_XBusy);</div>
</div><!-- fragment --> </div><!-- contents -->
</div><!-- doc-content -->
<!-- HTML footer for doxygen 1.8.5-->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul class="foot">
    <li class="footer">Thu Sep 24 2015 &copy; 2015 Freescale Semiconductor, Inc. All rights reserved.
    </li>
  </ul>
</div>
</body>
</html>
